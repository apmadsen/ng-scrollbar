angular.module("ngScrollbar",[]).directive("ngScrollbar",["$parse","$window",function(e,t){return{restrict:"AC",replace:!0,transclude:!0,scope:{},link:function(e,n,o){var a,r,i,l,s,h={mainElm:null,tools:null,transcludedContainer:null,thumb:null,thumbLine:null,track:null},u={bottom:o.hasOwnProperty("bottom")},c=angular.element(t),d=!!c[0].addEventListener,p=!!c[0].removeEventListener,m=0,g={top:0},v={top:0},b={calcStyles:function(){r={position:"relative",overflow:"hidden","max-width":"100%",height:"100%"},v.height&&(r.height=v.height+"px"),i={position:"absolute",height:g.height+"px",top:g.top+"px"},l={position:"relative","line-height":g.height+"px"},s={position:"relative",top:v.top+"px",overflow:"hidden"}},redraw:function(){h.thumb.css("top",g.top+"px");var e=g.top/v.height;v.top=-Math.round(v.scrollHeight*e),h.transcludedContainer.css("top",v.top+"px")},thumbDrag:function(e,t,n){g.top=Math.max(0,Math.min(parseInt(g.trackHeight,10)-parseInt(g.height,10),n)),e.stopPropagation()},registerEvent:function(e){var t=void 0!==c[0].onmousewheel?"mousewheel":"DOMMouseScroll";d?e.addEventListener(t,w.wheel,!1):e.attachEvent("onmousewheel",w.wheel)},unregisterEvent:function(e){var t=void 0!==c[0].onmousewheel?"mousewheel":"DOMMouseScroll";p?e.removeEventListener(t,w.wheel,!1):e.detachEvent("onmousewheel",w.wheel)},build:function(t){t=u.bottom||t,h.mainElm=angular.element(n.children()[0]),h.transcludedContainer=angular.element(h.mainElm.children()[0]),h.tools=angular.element(h.mainElm.children()[1]),h.thumb=angular.element(angular.element(h.tools.children()[0]).children()[0]),h.thumbLine=angular.element(h.thumb.children()[0]),h.track=angular.element(angular.element(h.tools.children()[0]).children()[1]),v.height=n[0].offsetHeight,v.scrollHeight=h.transcludedContainer[0].scrollHeight,v.height<v.scrollHeight?(e.showYScrollbar=!0,e.$emit("scrollbar.show"),g.height=Math.round(v.height/v.scrollHeight*v.height),g.trackHeight=v.height,b.calcStyles(),n.css({overflow:"hidden"}),h.mainElm.css(r),h.transcludedContainer.css(s),h.thumb.css(i),h.thumbLine.css(l),h.track.bind("click",w.trackClick),b.registerEvent(h.transcludedContainer[0]),h.thumb.on("mousedown",function(e){m=e.pageY-h.thumb[0].offsetTop,c.on("mouseup",w.mouseUp),c.on("mousemove",w.drag),e.preventDefault()}),h.transcludedContainer.on("touchstart",function(e){m=e.changedTouches[0].pageY-h.transcludedContainer[0].offsetTop,h.transcludedContainer.on("touchend",w.touchEnd),h.transcludedContainer.on("touchmove",w.touchDrag),e.preventDefault()}),t?(u.bottom=!1,g.top=parseInt(v.height,10)-parseInt(g.height,10)):g.top=Math.max(0,Math.min(parseInt(v.height,10)-parseInt(g.height,10),parseInt(g.top,10))),b.redraw()):(e.showYScrollbar=!1,e.$emit("scrollbar.hide"),h.thumb.off("mousedown"),b.unregisterEvent(h.transcludedContainer[0]),h.transcludedContainer.attr("style","position:relative;top:0"),h.mainElm.css({height:"100%"}))},rebuild:function(t,n){null!=a&&clearTimeout(a);var o=!!n&&!!n.rollToBottom;a=setTimeout(function(){v.height=null,b.build(o),e.$$phase||e.$digest(),e.$parent.$$phase||e.$parent.$digest()},72)}},w={trackClick:function(e){var t=e.hasOwnProperty("offsetY")?e.offsetY:e.layerY,n=Math.max(0,Math.min(parseInt(g.trackHeight,10)-parseInt(g.height,10),t));g.top=n,b.redraw(),e.stopPropagation()},wheel:function(e){var t=40,n=e,o=n.detail,a=n.wheelDelta,r=225,i=r-1;return o=o?a&&(f=a/o)?o/f:-o/1.35:a/120,o=1>o?-1>o?(-Math.pow(o,2)-i)/r:o:(Math.pow(o,2)+i)/r,e.delta=Math.min(Math.max(o/2,-1),1),e.delta=e.delta*t,g.top=Math.max(0,Math.min(parseInt(v.height,10)-parseInt(g.height,10),parseInt(g.top,10)-e.delta)),b.redraw(),e.preventDefault?void e.preventDefault():!1},mouseUp:function(e){c.off("mousemove",w.drag),c.off("mouseup",w.mouseUp),e.stopPropagation()},drag:function(e){var t=0,n=e.pageY-h.thumb[0].scrollTop-m;b.thumbDrag(e,t,n),b.redraw()},touchDrag:function(e){var t=0,n=e.changedTouches[0].pageY-m;b.thumbDrag(e,t,-n),b.redraw(),e.stopPropagation()},touchEnd:function(e){h.transcludedContainer.off("touchmove",w.touchDrag),h.transcludedContainer.off("touchend",w.touchEnd),e.stopPropagation()}};b.build(),o.rebuildOn&&o.rebuildOn.split(" ").forEach(function(t){e.$on(t,b.rebuild)}),o.hasOwnProperty("rebuildOnResize")&&c.on("resize",b.rebuild)},template:'<div>  <div class="ngsb-wrap">    <div class="ngsb-container" ng-transclude></div>    <div class="ngsb-scrollbar" style="position: absolute; display: block;" ng-show="showYScrollbar">      <div class="ngsb-thumb-container">        <div class="ngsb-thumb-pos" oncontextmenu="return false;">          <div class="ngsb-thumb" ></div>        </div>        <div class="ngsb-track"></div>      </div>    </div>  </div></div>'}}]);
